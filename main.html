<!DOCTYPE html>

<html>
	<head>
		<script>

			var number=5;
			var count = 1;
			var languageArray = [];
			var htmlArray = [];
			var displayNumber;
			var totalDisplayed;
			var python = false;
			var json = false;
			var javascript_l = false;
			var sql = false;
			var searchArray = [];
			var searchArrayText1 = [];
			var searchArrayText2 = [];
			var descripArray = [];
			var favDescrip = [];
			var idArray = [];


			window.onload = function () {
				/*var form = document.getElementById("resultsForm");
				form.onsubmit = setNumber;*/

				var opt1 = document.getElementById("noResults1");
				var opt2 = document.getElementById("noResults2");
				var opt3 = document.getElementById("noResults3");
				var opt4 = document.getElementById("noResults4");
				var opt5 = document.getElementById("noResults5");

				var opt6 = document.getElementById("results1");
				var opt7 = document.getElementById("results2");
				var opt8 = document.getElementById("results3");
				var opt9 = document.getElementById("results4");

				opt1.onclick = setNumber30;
				opt2.onclick = setNumber60;
				opt3.onclick = setNumber90;
				opt4.onclick = setNumber120;
				opt5.onclick = setNumber150;
				opt6.onclick = setLang1;
				opt7.onclick = setLang2;
				opt8.onclick = setLang3;
				opt9.onclick = setLang4;

				function setNumber30 () {
					displayNumber = 30;
					totalDisplayed = displayNumber;
					console.log(number);
				}

				function setNumber60 () {
					displayNumber = 60;
					totalDisplayed = displayNumber;
					console.log(number);
				}

				function setNumber90 () {
					displayNumber = 90;
					totalDisplayed = displayNumber;
					console.log(number);
				}
			
				function setNumber120 () {
					displayNumber = 120;
					totalDisplayed = displayNumber;
					console.log(number);
				}

				function setNumber150 () {
					displayNumber = 150;
					totalDisplayed = displayNumber;
					console.log(number);
				}

				function setLang1 () {
					python = true;
					console.log(python);
				}

				function setLang2 () {
					json = true;
					console.log(json);
				}
			
				function setLang3 () {
					javascript_l = true;
					console.log(javascript_l);
				}

				function setLang4 () {
					sql = true;
					console.log(sql);
				}

			}
			

			function controlGist() {
				for (var i=0; i<number; i++) {
					openGist();
					count = count + 1;
				}

			}

			function openGist () {

				var url;
				console.log("tiffany");
				var request = new XMLHttpRequest();
				url = 'https://api.github.com/gists' + '?page=' + count;
				console.log(count);
				request.onreadystatechange = ifready;
				request.open('GET', url, true);
				request.send();


				/*for (var i=0; i<number; i++) {
					var request = new XMLHttpRequest();
					url = 'https://api.github.com/gists' + '?page=' + (i+1);
					request.onreadystatechange = ifready;
					request.open('GET', url, true);
					request.send();
					
				}*/
			
			
			/*function ifReady () {
				console.log("Hi");
				/*var data = JSON.parse(request.responseText);
				console.log(data[0].html_url);
			}*/
		
				//request.open('GET', 'https://api.github.com/gists?page=2', true);

				function ifready() {
					if (request.readyState === 4) {
						var data = JSON.parse(request.responseText);
						console.log(data[1].html_url);
						getArray(data);
					}
					//else {
						//document.getElementById("test").innerHTML = "no success!";
					//}
				}
				

			function getArray (input) {
				var parent;
				var fileName;
				for (var i=0; i<input.length; i++) {
					htmlArray.push(input[i].html_url);

					parent = input[i].files;
					for (var property in parent) {
						fileName = property;
					}

					for (var cProp in parent[fileName]) {
						if (cProp === "language") {
							languageArray.push(parent[fileName][cProp]);
						}
					}	

					descripArray.push(input[i].description);
					
					idArray.push(input[i].id);
				}

				//console.log (descripArray.length);
				//console.log (idArray.length);
			//console.log (htmlArray.length);

			}
		}
		

		

		function displayResults () {
			
			var dispArea = document.getElementById("results");

			while (dispArea.childNodes[0]) {
				dispArea.childNodes[0].removeChild(dispArea.childNodes[0].childNodes[2]);
				dispArea.childNodes[0].removeChild(dispArea.childNodes[0].childNodes[1]);
				dispArea.childNodes[0].removeChild(dispArea.childNodes[0].childNodes[0]);
				dispArea.removeChild(dispArea.childNodes[0]);
			}

			var text;
			var langText;
			for (var z=0; z<displayNumber; z++) {
				text = htmlArray[z].toString();
				langText = String(languageArray[z]);
				searchArrayText1[z] = text; 
				searchArrayText2[z] = langText; //dunno if necessary
				var newP = document.createElement("p");
				var addText = document.createElement("p");
				addText.innerHTML = '<a href=\"' + text + '">' + text + '</a>         ';
				//var addText = document.createTextNode("<a href=\"" + text + "\">         ");
				var addMoreText = document.createTextNode(langText);
				var addButton = document.createElement("div");
				addButton.innerHTML = '<input type ="button" id='+ idArray[z] + ' value="Add to Favorites" onClick="favorites(this.id);" />';
				newP.appendChild(addText);
				newP.appendChild(addMoreText);
				newP.appendChild(addButton);
				dispArea.appendChild(newP);

				descripText = String(descripArray[z]);
				favDescrip[z] = descripText;
			}

			//console.log(dispArea.childNodes[0].length);

		}

		function search () {
			// function will narrow search
			var displArea = document.getElementById("results");
			var languageText;
			var w=0;
			var c=0;
			var htmlText;
			var displayCount;
			var buttonID;

			
			if (displArea.childNodes[0]) {
	
				if (python === true) {

					while (w < displayNumber) {
						languageText = displArea.childNodes[w].childNodes[1].nodeValue;
						if (languageText.toLowerCase() === "python") {
							//console.log (languageText + " " + w);
							//console.log (displArea.childNodes[w].childNodes[2]);
							buttonID = displArea.childNodes[w].childNodes[2].childNodes[0].id;
							// http://stackoverflow.com/questions/17428383/get-an-elements-id-and-compare-it-to-a-string-or-another-id
							// didn't copy a stretch of code, but got inspiration from Darren Davies's code here
							searchArray[c] = buttonID;
							c = c+1;
						}
						w=w+1;
					}

					while (displArea.childNodes[0]) {
						displArea.childNodes[0].removeChild(displArea.childNodes[0].childNodes[2]);
						displArea.childNodes[0].removeChild(displArea.childNodes[0].childNodes[1]);
						displArea.childNodes[0].removeChild(displArea.childNodes[0].childNodes[0]);
						displArea.removeChild(displArea.childNodes[0]);
					}

					

					for (var g=0; g<searchArray.length; g++) {

						for (var h=0; h<idArray.length; h++) {
							if (searchArray[g] === idArray[h]) {		

								var htext = searchArrayText1[h];
								var lText = searchArrayText2[h];
								var newP = document.createElement("p");
								var addText = document.createElement("p");
								addText.innerHTML = '<a href=\"' + htext + '">' + htext + '</a>         ';
								var addMoreText = document.createTextNode(lText);
								var addButton = document.createElement("div");
								addButton.innerHTML = '<input type ="button" id='+ idArray[h] + ' value="Add to Favorites" onClick="favorites(this.id);" />';
								newP.appendChild(addText);
								newP.appendChild(addMoreText);
								newP.appendChild(addButton);
								displArea.appendChild(newP);

								displayCount = displayCount + 1;
							}				

						}
			
					}
					displayNumber = displayCount;
				}

				if (json === true) {

					while (w < displayNumber) {
						languageText = displArea.childNodes[w].childNodes[1].nodeValue;
						if (languageText.toLowerCase() === "json") {
							buttonID = displArea.childNodes[w].childNodes[2].childNodes[0].id;
							searchArray[c] = buttonID;
							c = c+1;
						}
						w=w+1;
					}

					while (displArea.childNodes[0]) {
						displArea.childNodes[0].removeChild(displArea.childNodes[0].childNodes[2]);
						displArea.childNodes[0].removeChild(displArea.childNodes[0].childNodes[1]);
						displArea.childNodes[0].removeChild(displArea.childNodes[0].childNodes[0]);
						displArea.removeChild(displArea.childNodes[0]);
					}

					for (g=0; g<searchArray.length; g++) {

						for (h=0; h<idArray.length; h++) {
							if (searchArray[g] === idArray[h]) {		

								htext = searchArrayText1[h];
								lText = searchArrayText2[h];
								newP = document.createElement("p");
								addText = document.createElement("p");
								addText.innerHTML = '<a href=\"' + htext + '">' + htext + '</a>         ';
								addMoreText = document.createTextNode(lText);
								addButton = document.createElement("div");
								addButton.innerHTML = '<input type ="button" id='+ idArray[h] + ' value="Add to Favorites" onClick="favorites(this.id);" />';
								newP.appendChild(addText);
								newP.appendChild(addMoreText);
								newP.appendChild(addButton);
								displArea.appendChild(newP);

								displayCount = displayCount + 1;
							}				

						}
			
					}

					displayNumber = displayCount;
			
				}

				if (javascript_l === true) {

					while (w < displayNumber) {
						languageText = displArea.childNodes[w].childNodes[1].nodeValue;
						if (languageText.toLowerCase() === "javascript") {
							buttonID = displArea.childNodes[w].childNodes[2].childNodes[0].id;
							searchArray[c] = buttonID;
							c = c+1;
						}
						w=w+1;
					}

					while (displArea.childNodes[0]) {
						displArea.childNodes[0].removeChild(displArea.childNodes[0].childNodes[2]);
						displArea.childNodes[0].removeChild(displArea.childNodes[0].childNodes[1]);
						displArea.childNodes[0].removeChild(displArea.childNodes[0].childNodes[0]);
						displArea.removeChild(displArea.childNodes[0]);
					}

					for (g=0; g<searchArray.length; g++) {

						for (h=0; h<idArray.length; h++) {
							if (searchArray[g] === idArray[h]) {		

								htext = searchArrayText1[h];
								lText = searchArrayText2[h];
								newP = document.createElement("p");
								addText = document.createElement("p");
								addText.innerHTML = '<a href=\"' + htext + '">' + htext + '</a>         ';
								addMoreText = document.createTextNode(lText);
								addButton = document.createElement("div");
								addButton.innerHTML = '<input type ="button" id='+ idArray[h] + ' value="Add to Favorites" onClick="favorites(this.id);" />';
								newP.appendChild(addText);
								newP.appendChild(addMoreText);
								newP.appendChild(addButton);
								displArea.appendChild(newP);

								displayCount = displayCount + 1;
							}				

						}
			
					}
					displayNumber = displayCount;
			
				}

				if (sql === true) {

					while (w < displayNumber) {
						languageText = displArea.childNodes[w].childNodes[1].nodeValue;
						if (languageText.toLowerCase() === "sql") {
							buttonID = displArea.childNodes[w].childNodes[2].childNodes[0].id;
							searchArray[c] = buttonID;
							c = c+1;
						}
						w=w+1;
					}

					while (displArea.childNodes[0]) {
						displArea.childNodes[0].removeChild(displArea.childNodes[0].childNodes[2]);
						displArea.childNodes[0].removeChild(displArea.childNodes[0].childNodes[1]);
						displArea.childNodes[0].removeChild(displArea.childNodes[0].childNodes[0]);
						displArea.removeChild(displArea.childNodes[0]);
					}

					for (g=0; g<searchArray.length; g++) {

						for (h=0; h<idArray.length; h++) {
							if (searchArray[g] === idArray[h]) {		

								htext = searchArrayText1[h];
								lText = searchArrayText2[h];
								newP = document.createElement("p");
								addText = document.createElement("p");
								addText.innerHTML = '<a href=\"' + htext + '">' + htext + '</a>         ';
								addMoreText = document.createTextNode(lText);
								addButton = document.createElement("div");
								addButton.innerHTML = '<input type ="button" id='+ idArray[h] + ' value="Add to Favorites" onClick="favorites(this.id);" />';
								newP.appendChild(addText);
								newP.appendChild(addMoreText);
								newP.appendChild(addButton);
								displArea.appendChild(newP);

								displayCount = displayCount + 1;
							}				

						}
			
					}
					displayNumber = displayCount;
			
				}




				 /*
			else {
				var message = "Please select a number of results first!";
				var newP = document.createElement("p");
				var addText = document.createTextNode(message);
				newP.appendChild(addText);
				displArea.appendChild(newP);
			} */

		}
	}
		var favOrder = 0;
		var numberDisp = totalDisplayed;
		function favorites(id_value) {
			// console.log(id_value);

			// if that works then:

			for (var y=0; y<idArray.length; y++) {
				if (id_value === idArray[y]) {
					var index = y;
				}
			}


			//var strIndex = id_value.slice(2);
			//index = Number(strIndex);
			// console.log(index);

			var favDiv = document.getElementById("favorites");

			var hLink = '<a href=\"' + searchArrayText1[index] + '">' + searchArrayText1[index] + '</a>         ';
			localStorage.setItem('link', hLink);
			localStorage.setItem('language', searchArrayText2[index]);
			localStorage.setItem('description', favDescrip[index]);

			var newP = document.createElement("p");
			var addText = document.createElement("p");
			addText.innerHTML = localStorage.getItem('link');
			var addMoreText = document.createTextNode(localStorage.getItem('language'));
			var gistsdesc = document.createTextNode(":    " + localStorage.getItem('description'));
			var addButton = document.createElement("div");
			addButton.innerHTML = '<input type ="button" id="id"' + id_value + 'value="Remove from Favorites" onClick="removeFav(this.id);" />';
			newP.appendChild(addText);
			newP.appendChild(addMoreText);
			newP.appendChild(gistsdesc);
			newP.appendChild(addButton);
			favDiv.appendChild(newP);

			favOrder = favOrder + 1;

			var favButton = document.getElementById(id_value);
			var buttonDiv = favButton.parentNode;
			var pNode = buttonDiv.parentNode;
			var resDiv = pNode.parentNode;

			//pNode.removeChild(pNode.childNodes[3]);
			pNode.removeChild(pNode.childNodes[2]);
			pNode.removeChild(pNode.childNodes[1]);
			pNode.removeChild(pNode.childNodes[0]);
			resDiv.removeChild(pNode);			

			displayNumber = displayNumber - 1;

			searchArrayText1.splice(index, 1);
			searchArrayText2.splice(index, 1);
			favDescrip.splice(index, 1);
			idArray.splice(index, 1);
			// removes the entries from ALL the arrays so that they will never reappear in the results

		}

		function removeFav () {
			



		}

	




		</script>
	</head>

	<body>
		<h3>Please 'Connect to Gist' first. Afterwards, select the number of results and click on 'Show Results'.</h3>
		<p>
			<button type = "submit" onClick="controlGist();">Connect to Gists</button>
		</p>
		<p>
			<form id = "resultsForm">
				<legend>Select the Number of Results:</legend>
					<input type="radio" id="noResults1" value="30" name="pick" />
					<label for "noResults">30</label>
					<input type="radio" id="noResults2" value="60" name="pick"/>
					<label for "noResults">60</label>
					<input type="radio" id="noResults3" value="90" name="pick"/>
					<label for "noResults">90</label>
					<input type="radio" id="noResults4" value="120" name="pick"/>
					<label for "noResults">120</label>
					<input type="radio" id="noResults5" value="150" name="pick"/>
					<label for "noResults">150</label>
			</form>
		</p>
		<p>
			<button type = "submit" onClick="displayResults();">Show Results</button>
		</p>
		<p>
			<form>
				<legend>Select a Langauge: (Must refresh to search for another language)</legend>
					<input type="checkbox" value="python" id="results1">Python</input>
					<input type="checkbox" value="json" id="results2">JSON</input>
					<input type="checkbox" value="javascript" id="results3">Javascript</input>
					<input type="checkbox" value="sql" id="results4">SQL</input>
					<input type="checkbox" value="sql" id="results5">No Languages</input>
					<!-- Selecting No Languages should not do anything -->
			</form>
		</p>
		<p>
			<button type = "submit" onClick="search();">Search</button>
		</p>
		<h4>Favorites:</h4>
		<div id = "favorites"></div>
		<h4>Results:</h4>
		<div id = "results"></div>
	</body>

</html>